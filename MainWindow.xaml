<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="Configer.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:Configer.Models"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    Title="配置管理器">

    <Window.Content>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="88" /> <!-- Sidebar width -->
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Sidebar with thin border -->
            <Border Grid.Column="0" Background="White" BorderBrush="#E5E7EB" BorderThickness="1" Padding="4"> <!-- thin border and reduced padding -->
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- App title / icon at top -->
                    <StackPanel Orientation="Vertical" Margin="4" Grid.Row="0" HorizontalAlignment="Center">
                        <Image Source="Assets/icon.png" Width="32" Height="32" HorizontalAlignment="Center" />
                    </StackPanel>

                    <!-- Main navigation buttons (only Home and Deps) -->
                    <StackPanel Grid.Row="1" Orientation="Vertical" VerticalAlignment="Top" HorizontalAlignment="Center" Spacing="10" Margin="0,8,0,8">
                        <Button x:Name="NavItemDataConfig" Click="NavItem_Click" Tag="DataConfig" Width="64" Height="72" Style="{StaticResource SidebarButtonStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="6" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!-- selection indicator (left slim bar) -->
                                <Border x:Name="Indicator_DataConfig" Grid.Column="0" Background="#07D0F0" Visibility="Collapsed" CornerRadius="2,0,0,2" />

                                <StackPanel Grid.Column="1" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center" IsHitTestVisible="False">
                                    <SymbolIcon x:Name="Icon_Home" Symbol="Library" Foreground="#1F2933" Width="28" Height="28" />
                                    <TextBlock x:Name="Text_Home" Text="主页" Foreground="#1F2933" FontSize="11" HorizontalAlignment="Center" Margin="0,8,0,0" />
                                </StackPanel>
                            </Grid>
                        </Button>

                        <Button x:Name="NavItemRun" Click="NavItem_Click" Tag="Run" Width="64" Height="72" Style="{StaticResource SidebarButtonStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="6" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Border x:Name="Indicator_Run" Grid.Column="0" Background="#07D0F0" Visibility="Collapsed" CornerRadius="2,0,0,2" />

                                <StackPanel Grid.Column="1" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center" IsHitTestVisible="False">
                                    <SymbolIcon x:Name="Icon_Run" Symbol="Play" Foreground="#1F2933" Width="28" Height="28" />
                                    <TextBlock x:Name="Text_Run" Text="运行" Foreground="#1F2933" FontSize="11" HorizontalAlignment="Center" Margin="0,8,0,0" />
                                </StackPanel>
                            </Grid>
                        </Button>

                        <Button x:Name="NavItemDeps" Click="NavItem_Click" Tag="Deps" Width="64" Height="72" Style="{StaticResource SidebarButtonStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="6" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!-- selection indicator (left slim bar) -->
                                <Border x:Name="Indicator_Deps" Grid.Column="0" Background="#07D0F0" Visibility="Collapsed" CornerRadius="2,0,0,2" />

                                <StackPanel Grid.Column="1" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center" IsHitTestVisible="False">
                                    <!-- Checklist glyph (Segoe MDL2 Assets U+E946) -->
                                    <FontIcon x:Name="Icon_Deps" FontFamily="Segoe MDL2 Assets" Glyph="&#xE946;" Foreground="#1F2933" FontSize="20" />
                                    <TextBlock x:Name="Text_Deps" Text="依赖" Foreground="#1F2933" FontSize="11" HorizontalAlignment="Center" Margin="0,8,0,0" />
                                </StackPanel>
                            </Grid>
                        </Button>
                    </StackPanel>

                    <!-- Footer with Help and Setting buttons -->
                    <StackPanel Grid.Row="2" Orientation="Vertical" Margin="4" HorizontalAlignment="Center" VerticalAlignment="Bottom">
                        <Button x:Name="NavItemHelp" Width="64" Height="72" Style="{StaticResource SidebarButtonStyle}" Click="NavItem_Click" Tag="Help">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="6" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Border x:Name="Indicator_Help" Grid.Column="0" Background="#07D0F0" Visibility="Collapsed" CornerRadius="2,0,0,2" />
                                <StackPanel Grid.Column="1" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center" IsHitTestVisible="False">
                                    <SymbolIcon x:Name="Icon_Help" Symbol="Help" Foreground="#1F2933" Width="28" Height="28" />
                                    <TextBlock x:Name="Text_Help" Text="帮助" Foreground="#1F2933" FontSize="11" HorizontalAlignment="Center" Margin="0,8,0,0" />
                                </StackPanel>
                            </Grid>
                        </Button>

                        <Button x:Name="NavItemSettings" Width="64" Height="72" Style="{StaticResource SidebarButtonStyle}" Click="NavItem_Click" Tag="Settings" Margin="0,8,0,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="6" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Border x:Name="Indicator_Settings" Grid.Column="0" Background="#07D0F0" Visibility="Collapsed" CornerRadius="2,0,0,2" />
                                <StackPanel Grid.Column="1" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center" IsHitTestVisible="False">
                                    <SymbolIcon x:Name="Icon_Settings" Symbol="Setting" Foreground="Black" Width="28" Height="28" />
                                    <TextBlock x:Name="Text_Settings" Text="设置" Foreground="Black" FontSize="11" HorizontalAlignment="Center" Margin="0,8,0,0" />
                                </StackPanel>
                            </Grid>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Main content area -->
            <Grid Grid.Column="1">
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Padding="24">
                        <TextBlock x:Name="NavHeaderText" Text="配置管理器" FontSize="22" FontWeight="SemiBold"/>

                        <Grid x:Name="ContentRoot" Margin="0,12,0,0">
                            <!-- Existing pages copied from previous layout -->
                            <Grid x:Name="EmptyPage" Visibility="Collapsed" Padding="24">
                                <TextBlock Text="请选择左侧侧边栏的标签页。" HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0.7"/>
                            </Grid>

                            <Grid x:Name="DataConfigPage">
                                <!-- The original DataConfigPage ScrollViewer content is preserved here -->
                                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                    <Grid Padding="12">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="2*"/>
                                        </Grid.RowDefinitions>

                                        <!-- CommandBar -->
                                        <CommandBar Grid.Row="0" HorizontalAlignment="Stretch" Padding="6">
                                            <AppBarButton x:Name="BtnLoad" Click="LoadButton_Click">
                                                <AppBarButton.Content>
                                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                                        <Image Source="Assets/icon.png" Width="16" Height="16"/>
                                                        <TextBlock Text="加载配置" />
                                                    </StackPanel>
                                                </AppBarButton.Content>
                                            </AppBarButton>

                                            <AppBarButton x:Name="BtnSave" Click="SaveButton_Click">
                                                <AppBarButton.Content>
                                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                                        <Image Source="Assets/icon.png" Width="16" Height="16"/>
                                                        <TextBlock Text="保存配置" />
                                                    </StackPanel>
                                                </AppBarButton.Content>
                                            </AppBarButton>

                                            <AppBarButton x:Name="BtnOpenFolder" Click="OpenFolderButton_Click">
                                                <AppBarButton.Content>
                                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                                        <Image Source="Assets/icon.png" Width="16" Height="16"/>
                                                        <TextBlock Text="打开工作目录" />
                                                    </StackPanel>
                                                </AppBarButton.Content>
                                            </AppBarButton>

                                            <CommandBar.SecondaryCommands>
                                                <AppBarButton>
                                                    <AppBarButton.Content>
                                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                                            <Image Source="Assets/icon.png" Width="16" Height="16"/>
                                                            <TextBlock Text="关于" />
                                                        </StackPanel>
                                                    </AppBarButton.Content>
                                                </AppBarButton>
                                            </CommandBar.SecondaryCommands>
                                        </CommandBar>

                                        <!-- InfoBar -->
                                        <muxc:InfoBar Grid.Row="1" IsOpen="True" Severity="Informational" Margin="0,8,0,12" Message="管理 .env、lexicon.csv 与 data 下的 SRT 文件。所有操作请先保存。" />

                                        <!-- Top Main Content: Left=SRT, Right=lexicon -->
                                        <Grid Grid.Row="2" ColumnSpacing="12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="2*"/>
                                                <ColumnDefinition Width="3*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Left: SRT -->
                                            <Border Grid.Column="0" Padding="12" CornerRadius="8" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
                                                <StackPanel>
                                                    <Grid Margin="0,0,0,8">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>

                                                        <TextBlock Text="SRT 文件" FontWeight="SemiBold" VerticalAlignment="Center" />

                                                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                                                            <Button x:Name="ImportSrtButton" Click="ImportSrtButton_Click" MinWidth="80">
                                                                <TextBlock Text="导入" HorizontalAlignment="Center"/>
                                                            </Button>
                                                            <Button x:Name="RefreshSrtStatusButton" Click="RefreshSrtStatusButton_Click" MinWidth="80">
                                                                <TextBlock Text="刷新" HorizontalAlignment="Center"/>
                                                            </Button>
                                                        </StackPanel>
                                                    </Grid>

                                                    <ListView x:Name="SrtListView" SelectionMode="Single" Height="360" VerticalAlignment="Top">
                                                        <ListView.ItemTemplate>
                                                            <DataTemplate x:DataType="models:SrtFileItem">
                                                                <Grid ColumnSpacing="8" VerticalAlignment="Center">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*" />
                                                                        <ColumnDefinition Width="80" />
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Text="{x:Bind FileName}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                                    <TextBlock Grid.Column="1" Text="{x:Bind Status}" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                                                                </Grid>
                                                            </DataTemplate>
                                                        </ListView.ItemTemplate>
                                                    </ListView>
                                                </StackPanel>
                                            </Border>

                                            <!-- Right: lexicon -->
                                            <Border Grid.Column="1" Padding="12" CornerRadius="8" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
                                                <StackPanel>
                                                    <TextBlock Text="lexicon.csv" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                                    <ListView x:Name="LexiconListView" SelectionMode="Single" VerticalAlignment="Top">
                                                        <ListView.ItemTemplate>
                                                            <DataTemplate x:DataType="models:LexiconEntry">
                                                                <Grid ColumnSpacing="8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="180" />
                                                                        <ColumnDefinition Width="120" />
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBox Grid.Column="0" Text="{x:Bind Word, Mode=TwoWay}" PlaceholderText="词"/>
                                                                    <TextBox Grid.Column="1" Text="{x:Bind Tag, Mode=TwoWay}" PlaceholderText="标签"/>
                                                                </Grid>
                                                            </DataTemplate>
                                                        </ListView.ItemTemplate>
                                                    </ListView>

                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0" Spacing="8">
                                                        <Button x:Name="AddLexButton" Click="AddLexButton_Click">
                                                            <StackPanel Orientation="Horizontal" Spacing="6">
                                                                <Image Source="Assets/icon.png" Width="16" Height="16"/>
                                                                <TextBlock Text="新增词条"/>
                                                            </StackPanel>
                                                        </Button>
                                                        <Button x:Name="RemoveLexButton" Click="RemoveLexButton_Click">
                                                            <StackPanel Orientation="Horizontal" Spacing="6">
                                                                <Image Source="Assets/icon.png" Width="16" Height="16"/>
                                                                <TextBlock Text="删除选定"/>
                                                            </StackPanel>
                                                        </Button>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Border>
                                        </Grid>

                                        <!-- Bottom: .env spanning both columns -->
                                        <Border Grid.Row="3" Padding="12" CornerRadius="8" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
                                            <StackPanel>
                                                <TextBlock Text=".env 文件" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                                <ListView x:Name="EnvListView" SelectionMode="Single">
                                                    <ListView.ItemTemplate>
                                                        <DataTemplate x:DataType="models:EnvEntry">
                                                            <Grid ColumnSpacing="8">
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="160" />
                                                                    <ColumnDefinition Width="30" />
                                                                    <ColumnDefinition Width="*" />
                                                                </Grid.ColumnDefinitions>
                                                                <TextBox Grid.Column="0" Text="{x:Bind Key, Mode=TwoWay}" PlaceholderText="Key"/>
                                                                <TextBox Grid.Column="1" Text="=" IsReadOnly="True" Background="Transparent" BorderThickness="0" />
                                                                <TextBox Grid.Column="2" Text="{x:Bind Value, Mode=TwoWay}" PlaceholderText="Value"/>
                                                            </Grid>
                                                        </DataTemplate>
                                                    </ListView.ItemTemplate>
                                                </ListView>

                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0" Spacing="8">
                                                    <Button x:Name="AddEnvButton" Click="AddEnvButton_Click">
                                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                                            <Image Source="Assets/icon.png" Width="16" Height="16"/>
                                                            <TextBlock Text="新增条目"/>
                                                        </StackPanel>
                                                    </Button>
                                                    <Button x:Name="RemoveEnvButton" Click="RemoveEnvButton_Click">
                                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                                            <Image Source="Assets/icon.png" Width="16" Height="16"/>
                                                            <TextBlock Text="删除选定"/>
                                                        </StackPanel>
                                                    </Button>
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </ScrollViewer>
                            </Grid>

                            <Grid x:Name="DependenciesPage" Visibility="Collapsed">
                                <!-- Content for Dependencies page will be loaded dynamically -->
                            </Grid>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Grid>
    </Window.Content>
</Window>
